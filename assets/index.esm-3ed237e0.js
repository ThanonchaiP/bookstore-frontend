import{R as It,r as E}from"./index-442b5a61.js";import{s as Bt}from"./index-94e514cc.js";const L=new WeakMap,Dt={},M=()=>{},g=M(),nt=Object,l=t=>t===g,y=t=>typeof t=="function",x=(t,n)=>({...t,...n}),pt="undefined",st=typeof window!=pt,ft=typeof document!=pt,Jt=()=>st&&typeof window.requestAnimationFrame!=pt,Nt=(t,n)=>{const e=L.get(t);return[()=>t.get(n)||Dt,r=>{const o=t.get(n);e[5](n,x(o,r),o||Dt)},e[6]]},et=new WeakMap;let Kt=0;const G=t=>{const n=typeof t,e=t&&t.constructor,r=e==Date;let o,i;if(nt(t)===t&&!r&&e!=RegExp){if(o=et.get(t),o)return o;if(o=++Kt+"~",et.set(t,o),e==Array){for(o="@",i=0;i<t.length;i++)o+=G(t[i])+",";et.set(t,o)}if(e==nt){o="#";const c=nt.keys(t).sort();for(;!l(i=c.pop());)l(t[i])||(o+=i+":"+G(t[i])+",");et.set(t,o)}}else o=r?t.toJSON():n=="symbol"?t.toString():n=="string"?JSON.stringify(t):""+t;return o};let dt=!0;const $t=()=>dt,[Et,ht]=st&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[M,M],jt=()=>{const t=ft&&document.visibilityState;return l(t)||t!=="hidden"},Gt=t=>(ft&&document.addEventListener("visibilitychange",t),Et("focus",t),()=>{ft&&document.removeEventListener("visibilitychange",t),ht("focus",t)}),Yt=t=>{const n=()=>{dt=!0,t()},e=()=>{dt=!1};return Et("online",n),Et("offline",e),()=>{ht("online",n),ht("offline",e)}},Qt={isOnline:$t,isVisible:jt},Xt={initFocus:Gt,initReconnect:Yt},yt=!It.useId,Y=!st||"Deno"in window,Zt=t=>Jt()?window.requestAnimationFrame(t):setTimeout(t,1),ot=Y?E.useEffect:E.useLayoutEffect,ct=typeof navigator<"u"&&navigator.connection,Vt=!Y&&ct&&(["slow-2g","2g"].includes(ct.effectiveType)||ct.saveData),_t=t=>{if(y(t))try{t=t()}catch{t=""}const n=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?G(t):"",[t,n]};let te=0;const Rt=()=>++te,Lt=0,xt=1,Ft=2;var ut={__proto__:null,FOCUS_EVENT:Lt,RECONNECT_EVENT:xt,MUTATE_EVENT:Ft};async function Wt(...t){const[n,e,r,o]=t,i=x({populateCache:!0,throwOnError:!0},typeof o=="boolean"?{revalidate:o}:o||{});let c=i.populateCache;const u=i.rollbackOnError;let h=i.optimisticData;const V=i.revalidate!==!1,_=O=>typeof u=="function"?u(O):u!==!1,C=i.throwOnError;if(y(e)){const O=e,f=[],s=n.keys();for(let b=s.next();!b.done;b=s.next()){const A=b.value;!A.startsWith("$inf$")&&O(n.get(A)._k)&&f.push(A)}return Promise.all(f.map(v))}return v(e);async function v(O){const[f]=_t(O);if(!f)return;const[s,b]=Nt(n,f),[A,I,q]=L.get(n),U=A[f],H=()=>V&&(delete q[f],U&&U[0])?U[0](Ft).then(()=>s().data):s().data;if(t.length<3)return H();let a=r,S;const F=Rt();I[f]=[F,0];const z=!l(h),Q=s(),k=Q.data,X=Q._c,W=l(X)?k:X;if(z&&(h=y(h)?h(W):h,b({data:h,_c:W})),y(a))try{a=a(W)}catch(D){S=D}if(a&&y(a.then))if(a=await a.catch(D=>{S=D}),F!==I[f][0]){if(S)throw S;return a}else S&&z&&_(S)&&(c=!0,a=W,b({data:a,_c:g}));c&&(S||(y(c)&&(a=c(a,W)),b({data:a,_c:g}))),I[f][1]=Rt();const Z=await H();if(b({_c:g}),S){if(C)throw S;return}return c?Z:a}}const At=(t,n)=>{for(const e in t)t[e][0]&&t[e][0](n)},Mt=(t,n)=>{if(!L.has(t)){const e=x(Xt,n),r={},o=Wt.bind(g,t);let i=M;const c={},u=(_,C)=>{const v=c[_]||[];return c[_]=v,v.push(C),()=>v.splice(v.indexOf(C),1)},h=(_,C,v)=>{t.set(_,C);const O=c[_];if(O)for(let f=O.length;f--;)O[f](v,C)},V=()=>{if(!L.has(t)&&(L.set(t,[r,{},{},{},o,h,u]),!Y)){const _=e.initFocus(setTimeout.bind(g,At.bind(g,r,Lt))),C=e.initReconnect(setTimeout.bind(g,At.bind(g,r,xt)));i=()=>{_&&_(),C&&C(),L.delete(t)}}};return V(),[t,o,V,i]}return[t,L.get(t)[4]]},ee=(t,n,e,r,o)=>{const i=e.errorRetryCount,c=o.retryCount,u=~~((Math.random()+.5)*(1<<(c<8?c:8)))*e.errorRetryInterval;!l(i)&&c>i||setTimeout(r,u,o)},ne=(t,n)=>G(t)==G(n),[Tt,oe]=Mt(new Map),Ut=x({onLoadingSlow:M,onSuccess:M,onError:M,onErrorRetry:ee,onDiscarded:M,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Vt?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Vt?5e3:3e3,compare:ne,isPaused:()=>!1,cache:Tt,mutate:oe,fallback:{}},Qt),kt=(t,n)=>{const e=x(t,n);if(n){const{use:r,fallback:o}=t,{use:i,fallback:c}=n;r&&i&&(e.use=r.concat(i)),o&&c&&(e.fallback=x(o,c))}return e},mt=E.createContext({}),se=t=>{const{value:n}=t,e=E.useContext(mt),r=y(n),o=E.useMemo(()=>r?n(e):n,[r,e,n]),i=E.useMemo(()=>r?o:kt(e,o),[r,e,o]),c=o&&o.provider,[u]=E.useState(()=>c?Mt(c(i.cache||Tt),o):g);return u&&(i.cache=u[0],i.mutate=u[1]),ot(()=>{if(u)return u[2]&&u[2](),u[3]},[]),E.createElement(mt.Provider,x(t,{value:i}))},Pt=st&&window.__SWR_DEVTOOLS_USE__,re=Pt?window.__SWR_DEVTOOLS_USE__:[],ie=()=>{Pt&&(window.__SWR_DEVTOOLS_REACT__=It)},ae=t=>y(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],ce=()=>x(Ut,E.useContext(mt)),ue=t=>(n,e,r)=>t(n,e&&((...i)=>{const c=_t(n)[0],[,,,u]=L.get(Tt),h=u[c];return h?(delete u[c],h):e(...i)}),r),le=re.concat(ue),fe=t=>function(...e){const r=ce(),[o,i,c]=ae(e),u=kt(r,c);let h=t;const{use:V}=u,_=(V||[]).concat(le);for(let C=_.length;C--;)h=_[C](h);return h(o,i||u.fetcher||null,u)},de=(t,n,e)=>{const r=n[t]||(n[t]=[]);return r.push(e),()=>{const o=r.indexOf(e);o>=0&&(r[o]=r[r.length-1],r.pop())}};ie();const lt={dedupe:!0},Ee=(t,n,e)=>{const{cache:r,compare:o,suspense:i,fallbackData:c,revalidateOnMount:u,refreshInterval:h,refreshWhenHidden:V,refreshWhenOffline:_,keepPreviousData:C}=e,[v,O,f]=L.get(r),[s,b]=_t(t),A=E.useRef(!1),I=E.useRef(!1),q=E.useRef(s),U=E.useRef(n),H=E.useRef(e),a=()=>H.current,S=()=>a().isVisible()&&a().isOnline(),[F,z,Q]=Nt(r,s),k=E.useRef({}).current,X=l(c)?e.fallback[s]:c,W=(d,m)=>{let R=!0;for(const p in k){const T=p;o(m[T],d[T])||T==="data"&&l(d[T])&&o(m[T],it)||(R=!1)}return R},Z=E.useMemo(()=>{const d=(()=>!s||!n?!1:l(u)?!(a().isPaused()||i):u)(),m=()=>{const p=F(),T=x(p);return delete T._k,d?{isValidating:!0,isLoading:!0,...T}:T};let R=m();return()=>{const p=m();return W(p,R)?R:R=p}},[r,s]),D=Bt.useSyncExternalStore(E.useCallback(d=>Q(s,(m,R)=>{W(m,R)||d()}),[r,s]),Z,Z),Ct=!A.current,B=D.data,P=l(B)?X:B,rt=D.error,St=E.useRef(P),it=C?l(B)?St.current:B:P,wt=(()=>Ct&&!l(u)?u:a().isPaused()?!1:i?l(P)?!1:e.revalidateIfStale:l(P)||e.revalidateIfStale)(),gt=!!(s&&n&&Ct&&wt),qt=l(D.isValidating)?gt:D.isValidating,Ht=l(D.isLoading)?gt:D.isLoading,K=E.useCallback(async d=>{const m=U.current;if(!s||!m||I.current||a().isPaused())return!1;let R,p,T=!0;const $=d||{},J=!f[s]||!$.dedupe,j=()=>yt?!I.current&&s===q.current&&A.current:s===q.current,tt={isValidating:!1,isLoading:!1},vt=()=>{z(tt)},Ot=()=>{const w=f[s];w&&w[1]===p&&delete f[s]},bt={isValidating:!0};l(F().data)&&(bt.isLoading=!0);try{if(J&&(z(bt),e.loadingTimeout&&l(F().data)&&setTimeout(()=>{T&&j()&&a().onLoadingSlow(s,e)},e.loadingTimeout),f[s]=[m(b),Rt()]),[R,p]=f[s],R=await R,J&&setTimeout(Ot,e.dedupingInterval),!f[s]||f[s][1]!==p)return J&&j()&&a().onDiscarded(s),!1;tt.error=g;const w=O[s];if(!l(w)&&(p<=w[0]||p<=w[1]||w[1]===0))return vt(),J&&j()&&a().onDiscarded(s),!1;const N=F().data;tt.data=o(N,R)?N:R,J&&j()&&a().onSuccess(R,s,e)}catch(w){Ot();const N=a(),{shouldRetryOnError:at}=N;N.isPaused()||(tt.error=w,J&&j()&&(N.onError(w,s,N),(at===!0||y(at)&&at(w))&&S()&&N.onErrorRetry(w,s,N,K,{retryCount:($.retryCount||0)+1,dedupe:!0})))}return T=!1,vt(),!0},[s,r]),zt=E.useCallback((...d)=>Wt(r,q.current,...d),[]);if(ot(()=>{U.current=n,H.current=e,l(B)||(St.current=B)}),ot(()=>{if(!s)return;const d=K.bind(g,lt);let m=0;const p=de(s,v,T=>{if(T==ut.FOCUS_EVENT){const $=Date.now();a().revalidateOnFocus&&$>m&&S()&&(m=$+a().focusThrottleInterval,d())}else if(T==ut.RECONNECT_EVENT)a().revalidateOnReconnect&&S()&&d();else if(T==ut.MUTATE_EVENT)return K()});return I.current=!1,q.current=s,A.current=!0,z({_k:b}),wt&&(l(P)||Y?d():Zt(d)),()=>{I.current=!0,p()}},[s]),ot(()=>{let d;function m(){const p=y(h)?h(P):h;p&&d!==-1&&(d=setTimeout(R,p))}function R(){!F().error&&(V||a().isVisible())&&(_||a().isOnline())?K(lt).then(m):m()}return m(),()=>{d&&(clearTimeout(d),d=-1)}},[h,V,_,s]),E.useDebugValue(it),i&&l(P)&&s)throw!yt&&Y?new Error("Fallback data is required when using suspense in SSR."):(U.current=n,H.current=e,I.current=!1,l(rt)?K(lt):rt);return{mutate:zt,get data(){return k.data=!0,it},get error(){return k.error=!0,rt},get isValidating(){return k.isValidating=!0,qt},get isLoading(){return k.isLoading=!0,Ht}}},me=nt.defineProperty(se,"defaultValue",{value:Ut});var pe=fe(Ee);export{me as S,pe as u};
